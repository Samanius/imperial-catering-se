# База Данных - Инструкция по Настройке

## Проблема

При деплое на Vercel данные о ресторанах не сохраняются, потому что приложение использовало локальное хранилище браузера (`localStorage`). Каждый пользователь видел только свои данные в своем браузере.

## Решение

Приложение теперь использует **GitHub Gist** как централизованную базу данных. Все данные хранятся в облаке, и все пользователи видят одну и ту же информацию.

## Как Настроить (Для Владельца Сайта)

### Шаг 1: Создайте GitHub Personal Access Token

1. Перейдите на https://github.com/settings/tokens/new
2. Введите название токена: `Imperial Catering Database`
3. Выберите срок действия: `No expiration` (без срока действия)
4. Выберите область доступа (scope): **только `gist`** ✓
5. Нажмите "Generate token" внизу страницы
6. **ВАЖНО**: Скопируйте токен и сохраните в безопасном месте (он начинается с `ghp_...`)
   - Вы больше не сможете увидеть этот токен после закрытия страницы!

### Шаг 2: Настройте Базу Данных

#### Вариант A: Создать Новую Базу Данных

1. Откройте админ-панель сайта (нажмите на кнопку админа в верхнем меню)
2. Перейдите на вкладку **"Database"**
3. Нажмите кнопку **"Create New"**
4. Вставьте ваш GitHub токен
5. Нажмите **"Create Database"**
6. Система создаст новый Gist и покажет вам Gist ID
7. **ВАЖНО**: Сохраните этот Gist ID в надежном месте!

#### Вариант B: Подключиться к Существующей Базе

Если у вас уже есть Gist с данными:

1. Откройте админ-панель сайта
2. Перейдите на вкладку **"Database"**
3. Нажмите кнопку **"Connect Existing"**
4. Введите:
   - **Gist ID**: ID вашего существующего Gist (из URL: `gist.github.com/username/[THIS_IS_THE_ID]`)
   - **GitHub Token**: Ваш токен с правами доступа к gist
5. Нажмите **"Connect Database"**

### Шаг 3: Проверьте Подключение

После успешной настройки:
- ✅ Вы увидите зеленое сообщение "Database Connected"
- ✅ Можете создавать/редактировать рестораны
- ✅ Все изменения сохраняются в облаке
- ✅ Данные доступны всем пользователям сайта

## Важная Информация

### Безопасность

- **GitHub Token** - это как пароль от базы данных
- Храните его в секрете, не делитесь с другими
- Если токен скомпрометирован, удалите его на GitHub и создайте новый

### Резервное Копирование

- Все изменения автоматически сохраняются в локальные бэкапы (вкладка "Backups" в админ-панели)
- Вы можете скачать все бэкапы как JSON файл
- Рекомендуется периодически делать резервные копии

### Обновление Данных

- Используйте кнопку **"Refresh"** на вкладке Database, чтобы загрузить последние данные из облака
- Это полезно, если несколько администраторов работают одновременно

### Импорт из Google Sheets

- После настройки базы данных функция импорта из Google Sheets будет автоматически сохранять данные в облако
- Убедитесь, что база данных настроена ПЕРЕД импортом

## Просмотр Ваших Данных на GitHub

Чтобы увидеть вашу базу данных:

1. Перейдите на https://gist.github.com/
2. Найдите Gist с именем "MERIDIEN Yacht Catering - Restaurant Database"
3. Там вы увидите JSON файл со всеми вашими ресторанами

## Устранение Проблем

### "Database not configured"
- Вам нужно настроить базу данных через админ-панель
- Перейдите на вкладку "Database" и следуйте инструкциям

### "Invalid GitHub token"
- Токен неверный или истек
- Создайте новый токен и обновите настройки

### "Database not found"
- Gist ID неверный
- Проверьте правильность ID (скопируйте из URL вашего Gist)

### "Failed to save"
- Проверьте подключение к интернету
- Убедитесь, что токен все еще действителен
- Попробуйте обновить страницу и повторить операцию

## Технические Детали

- **Технология**: GitHub Gist API
- **Формат**: JSON
- **Синхронизация**: Автоматическая при каждом изменении
- **Кэш**: 5 секунд (для оптимизации производительности)

## Поддержка

Если у вас возникли проблемы с настройкой:
1. Проверьте, что токен имеет права доступа `gist`
2. Убедитесь, что вы используете правильный Gist ID
3. Попробуйте создать новую базу данных вместо подключения к существующей
